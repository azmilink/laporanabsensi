<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Absensi Pegawai - Bawaslu Riau</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .conditional-section {
            transition: all 0.3s ease-in-out;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
        }
        .conditional-section.visible {
            max-height: 1000px;
            opacity: 1;
            margin-top: 1.5rem;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-fade-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header Aplikasi -->
    <header class="bg-gradient-to-r from-orange-500 to-orange-600 text-white shadow-lg">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight text-center">
                Aplikasi Laporan Absensi Pegawai Bawaslu Riau
            </h1>
        </div>
    </header>

    <!-- Konten Utama -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            <form id="absensiForm" class="space-y-6">
                <!-- 1. Nama Pegawai (Dropdown) -->
                <div>
                    <label for="namaPegawai" class="block text-sm font-medium text-gray-700 mb-1">Nama Pegawai</label>
                    <select id="namaPegawai" name="namaPegawai" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 transition duration-150">
                        <option value="" disabled selected>-- Pilih Nama Pegawai --</option>
                        <option value="ASMIN SAFARI LUBIS">ASMIN SAFARI LUBIS</option>
                        <option value="TARMIZI">TARMIZI</option>
                        <option value="DONA DONORA">DONA DONORA</option>
                        <option value="GUSHENDRI">GUSHENDRI</option>
                        <option value="RIZKI KURNIAWAN">RIZKI KURNIAWAN</option>
                        <option value="ELVINA ARMISTA">ELVINA ARMISTA</option>
                        <option value="ASMED EFENDI">ASMED EFENDI</option>
                        <option value="VITRA AULIYA">VITRA AULIYA</option>
                        <option value="ANGGA PRATAMA">ANGGA PRATAMA</option>
                        <option value="ARYAN RIADI">ARYAN RIADI</option>
                        <option value="SRI REZEKI KHARIANTI">SRI REZEKI KHARIANTI</option>
                        <option value="LIZA APRIANA">LIZA APRIANA</option>
                        <option value="SULAIMAN FAKHRUR RAZI">SULAIMAN FAKHRUR RAZI</option>
                        <option value="TAMARA ARINDITA">TAMARA ARINDITA</option>
                        <option value="MUHAMMAD HASANUL ASY'ARY">MUHAMMAD HASANUL ASY'ARY</option>
                        <option value="LAODE MUHAMMAD AULIA">LAODE MUHAMMAD AULIA</option>
                        <option value="RESSY PUSPITA SARI">RESSY PUSPITA SARI</option>
                        <option value="MUTIARA FRITCILLA PANJAIATAN">MUTIARA FRITCILLA PANJAIATAN</option>
                        <option value="JEKI LEONAR ANDIKA TAMPU BOLON">JEKI LEONAR ANDIKA TAMPU BOLON</option>
                        <option value="ERMALIZHA PUTERI">ERMALIZHA PUTERI</option>
                        <option value="AZIZUL HAKIM">AZIZUL HAKIM</option>
                        <option value="BARITO GRINCA PAHALA SILALAHI">BARITO GRINCA PAHALA SILALAHI</option>
                        <option value="RAHMANESA">RAHMANESA</option>
                        <option value="HABIBULLAH">HABIBULLAH</option>
                        <option value="RIKI PRAYOGI">RIKI PRAYOGI</option>
                        <option value="ROZA FITRI YANI">ROZA FITRI YANI</option>
                        <option value="ERWINDU BUDI DARMA">ERWINDU BUDI DARMA</option>
                        <option value="ARI AGUNG PRAYITNO">ARI AGUNG PRAYITNO</option>
                        <option value="ARDIANSYAH EKA SAKTI">ARDIANSYAH EKA SAKTI</option>
                        <option value="MARCO ALFINDO MILLA JUNIOR">MARCO ALFINDO MILLA JUNIOR</option>
                        <option value="ISNITA AULIA SAFITRI">ISNITA AULIA SAFITRI</option>
                        <option value="T. AYUDEA RAHMADHANI">T. AYUDEA RAHMADHANI</option>
                        <option value="FITRI RAHMADANI">FITRI RAHMADANI</option>
                        <option value="RACHMATUL AZMI">RACHMATUL AZMI</option>
                        <option value="IRHAM">IRHAM</option>
                        <option value="M. HAMIDI MAIZA">M. HAMIDI MAIZA</option>
                        <option value="WILSON SAPUTRA">WILSON SAPUTRA</option>
                        <option value="RIRIN SULPIANI">RIRIN SULPIANI</option>
                        <option value="DARUSSALIM">DARUSSALIM</option>
                        <option value="NOVI SULASTRI">NOVI SULASTRI</option>
                        <option value="NUR ASIAH">NUR ASIAH</option>
                        <option value="NURHUDA SYAH">NURHUDA SYAH</option>
                        <option value="PUTRI WULAN SARI">PUTRI WULAN SARI</option>
                        <option value="RIDUWAN SAPUTRA">RIDUWAN SAPUTRA</option>
                        <option value="VERI HIDAYAT">VERI HIDAYAT</option>
                        <option value="ZULKARNAIN NASUTION">ZULKARNAIN NASUTION</option>
                        <option value="HERSYA NOGRAHA PRAMASWARI">HERSYA NOGRAHA PRAMASWARI</option>
                        <option value="ZUHRI">ZUHRI</option>
                        <option value="ARI SETIAWAN">ARI SETIAWAN</option>
                        <option value="EKA PUTRI HERMAYANI TANUWIJAYA">EKA PUTRI HERMAYANI TANUWIJAYA</option>
                        <option value="NASRUN RITONGA">NASRUN RITONGA</option>
                        <option value="HENDRIANTO HERMAWAN">HENDRIANTO HERMAWAN</option>
                        <option value="FERI SUSANDRA">FERI SUSANDRA</option>
                        <option value="ALFIN RESKI">ALFIN RESKI</option>
                        <option value="YANIS PRIMA">YANIS PRIMA</option>
                        <option value="SONI DARMUJIANTO">SONI DARMUJIANTO</option>
                        <option value="DANDI KURNIAWAN">DANDI KURNIAWAN</option>
                        <option value="JEFRI">JEFRI</option>
                        <option value="ANDRI ALI SAPUTRA">ANDRI ALI SAPUTRA</option>
                    </select>
                </div>

                <!-- 2. Presensi Absensi -->
                <div>
                    <label for="presensi" class="block text-sm font-medium text-gray-700 mb-1">Jenis Laporan Absensi</label>
                    <select id="presensi" name="presensi" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 transition duration-150">
                        <option value="" disabled selected>-- Pilih Jenis Laporan --</option>
                        <option value="lupa-absensi">Lupa Absensi</option>
                        <option value="izin">Izin</option>
                        <option value="kendala-mesin">Kendala Mesin Absensi</option>
                        <option value="dinas-luar">Dinas Luar</option>
                        <option value="wfa">Work From Anywhere (WFA)</option>
                    </select>
                </div>

                <!-- 3. Lupa Absensi -->
                <div id="lupaAbsenSection" class="conditional-section space-y-4">
                    <div>
                        <label for="tanggalLupaAbsen" class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
                        <input type="date" id="tanggalLupaAbsen" name="tanggal" class="date-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                    </div>
                    <div>
                        <label for="dokumenLupaAbsen" class="block text-sm font-medium text-gray-700 mb-1">Upload Dokumen Pendukung</label>
                        <input type="file" id="dokumenLupaAbsen" name="dokumen" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100">
                    </div>
                </div>
                
                <!-- 4. Kendala Mesin Absensi -->
                <div id="kendalaMesinSection" class="conditional-section space-y-4">
                    <div>
                        <label for="deskripsiKendala" class="block text-sm font-medium text-gray-700 mb-1">Deskripsi Kendala</label>
                        <textarea id="deskripsiKendala" name="deskripsiKendala" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" placeholder="Jelaskan kendala yang Anda alami..."></textarea>
                    </div>
                    <div>
                        <label for="tanggalKendala" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Kendala</label>
                        <input type="date" id="tanggalKendala" name="tanggal" class="date-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                    </div>
                    <div>
                        <label for="dokumenKendala" class="block text-sm font-medium text-gray-700 mb-1">Upload Foto/Video Bukti</label>
                        <input type="file" id="dokumenKendala" name="dokumen" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100">
                    </div>
                </div>

                <!-- 5 & 6. WFA -->
                <div id="wfaSection" class="conditional-section space-y-4">
                    <div>
                        <label for="wfaPilihan" class="block text-sm font-medium text-gray-700 mb-1">Pilihan Absensi WFA</label>
                        <select id="wfaPilihan" name="wfaPilihan" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                            <option value="" disabled selected>-- Pilih Absensi --</option>
                            <option value="absensi-masuk">Absensi Masuk</option>
                            <option value="absensi-pulang">Absensi Pulang</option>
                        </select>
                    </div>
                    <div id="wfaMasukSection" class="conditional-section space-y-4">
                        <label for="rencanaKerja" class="block text-sm font-medium text-gray-700 mb-1">Rencana Kerja Hari Ini</label>
                        <textarea id="rencanaKerja" name="keterangan" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" placeholder="Jelaskan rencana kerja Anda..."></textarea>
                        <div>
                            <label for="tanggalWfaMasuk" class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
                            <input type="date" id="tanggalWfaMasuk" name="tanggal" class="date-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                    <div id="wfaPulangSection" class="conditional-section space-y-4">
                        <label for="pencapaianKerja" class="block text-sm font-medium text-gray-700 mb-1">Pencapaian Target Kerja Hari Ini</label>
                        <textarea id="pencapaianKerja" name="keterangan" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" placeholder="Jelaskan pencapaian target Anda..."></textarea>
                        <div>
                            <label for="tanggalWfaPulang" class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
                            <input type="date" id="tanggalWfaPulang" name="tanggal" class="date-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                </div>

                <!-- 7. Dinas Luar -->
                <div id="dinasLuarSection" class="conditional-section space-y-4">
                    <div>
                        <label for="kotaTujuan" class="block text-sm font-medium text-gray-700 mb-1">Kota Tujuan</label>
                        <input type="text" id="kotaTujuan" name="kotaTujuan" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" placeholder="Contoh: Jakarta">
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="tanggalPergi" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Pergi</label>
                            <input type="date" id="tanggalPergi" name="tanggalPergi" class="date-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label for="tanggalPulang" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Pulang</label>
                            <input type="date" id="tanggalPulang" name="tanggalPulang" class="date-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                    <div>
                        <label for="dokumenDinas" class="block text-sm font-medium text-gray-700 mb-1">Upload Surat Tugas</label>
                        <input type="file" id="dokumenDinas" name="dokumen" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100">
                    </div>
                </div>

                <!-- 8. Izin -->
                <div id="izinSection" class="conditional-section space-y-4">
                     <div>
                        <label for="perihalIzin" class="block text-sm font-medium text-gray-700 mb-1">Perihal</label>
                        <textarea id="perihalIzin" name="perihalIzin" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" placeholder="Contoh: Izin sakit, urusan keluarga, dll."></textarea>
                    </div>
                    <div>
                        <label for="tanggalIzin" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Izin</label>
                        <input type="date" id="tanggalIzin" name="tanggal" class="date-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                    </div>
                    <div>
                        <label for="dokumenIzin" class="block text-sm font-medium text-gray-700 mb-1">Upload Surat Izin/Dokter</label>
                        <input type="file" id="dokumenIzin" name="dokumen" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100">
                    </div>
                </div>

                <!-- Tombol Submit -->
                <div class="pt-4">
                    <button type="submit" id="submitButton" class="w-full flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition duration-150 disabled:bg-orange-300">
                        <span id="buttonText">Submit Laporan</span>
                        <svg id="loadingSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Popup/Modal Sukses -->
    <div id="successModal" class="fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full text-center modal-fade-in">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4">
                <svg class="h-10 w-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-900">Berhasil!</h3>
            <p id="modalMessage" class="text-gray-600 mt-2">Laporan absensi Anda sudah diterima.</p>
            <button id="closeModal" class="mt-6 w-full px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition duration-150">
                Tutup
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Variabel Elemen ---
            const form = document.getElementById('absensiForm');
            const namaPegawaiSelect = document.getElementById('namaPegawai');
            const presensiSelect = document.getElementById('presensi');
            const wfaPilihanSelect = document.getElementById('wfaPilihan');
            
            const sections = {
                lupaAbsen: document.getElementById('lupaAbsenSection'),
                kendalaMesin: document.getElementById('kendalaMesinSection'),
                izin: document.getElementById('izinSection'),
                wfa: document.getElementById('wfaSection'),
                wfaMasuk: document.getElementById('wfaMasukSection'),
                wfaPulang: document.getElementById('wfaPulangSection'),
                dinasLuar: document.getElementById('dinasLuarSection')
            };

            const submitButton = document.getElementById('submitButton');
            const buttonText = document.getElementById('buttonText');
            const loadingSpinner = document.getElementById('loadingSpinner');

            const successModal = document.getElementById('successModal');
            const modalMessage = document.getElementById('modalMessage');
            const closeModalButton = document.getElementById('closeModal');

            // --- Fungsi untuk membatasi tanggal (tidak bisa memilih tanggal mundur) ---
            function setMinDateForInputs() {
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-based
                const dd = String(today.getDate()).padStart(2, '0');
                const todayString = `${yyyy}-${mm}-${dd}`;
                
                document.querySelectorAll('.date-input').forEach(input => {
                    input.setAttribute('min', todayString);
                });
            }
            // Panggil fungsi ini sekali saat halaman dimuat untuk mengatur default
            setMinDateForInputs();

            // --- Fungsi utilitas ---
            function hideAllSections() {
                Object.values(sections).forEach(section => section.classList.remove('visible'));
            }
            function hideWfaSubSections() {
                sections.wfaMasuk.classList.remove('visible');
                sections.wfaPulang.classList.remove('visible');
            }

            // --- Event Listener untuk Dropdown Utama ---
            presensiSelect.addEventListener('change', function () {
                hideAllSections();
                
                // PENTING: Reset semua input tanggal agar terkunci kembali setiap kali ada perubahan
                setMinDateForInputs();
                
                const selectedValue = this.value;

                switch (selectedValue) {
                    case 'lupa-absensi':
                        sections.lupaAbsen.classList.add('visible');
                        // Buka kunci untuk Lupa Absensi
                        document.getElementById('tanggalLupaAbsen').removeAttribute('min');
                        break;
                    case 'kendala-mesin':
                        sections.kendalaMesin.classList.add('visible');
                        // Kunci tanggal tetap berlaku (dari setMinDateForInputs)
                        break;
                    case 'izin':
                        sections.izin.classList.add('visible');
                        // Buka kunci untuk Izin
                        document.getElementById('tanggalIzin').removeAttribute('min');
                        break;
                    case 'wfa':
                        sections.wfa.classList.add('visible');
                        wfaPilihanSelect.value = '';
                        hideWfaSubSections();
                        // Kunci tanggal tetap berlaku (dari setMinDateForInputs)
                        break;
                    case 'dinas-luar':
                        sections.dinasLuar.classList.add('visible');
                        // Buka kunci untuk Dinas Luar
                        document.getElementById('tanggalPergi').removeAttribute('min');
                        document.getElementById('tanggalPulang').removeAttribute('min');
                        break;
                }
            });

            // --- Event Listener untuk Dropdown WFA ---
            wfaPilihanSelect.addEventListener('change', function () {
                hideWfaSubSections();
                if (this.value === 'absensi-masuk') {
                    sections.wfaMasuk.classList.add('visible');
                } else if (this.value === 'absensi-pulang') {
                    sections.wfaPulang.classList.add('visible');
                }
            });

            // --- Event Listener untuk Submit Form ---
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                
                submitButton.disabled = true;
                buttonText.textContent = 'Mengirim...';
                loadingSpinner.classList.remove('hidden');

                const fileInputs = {
                    'lupa-absensi': document.getElementById('dokumenLupaAbsen'),
                    'kendala-mesin': document.getElementById('dokumenKendala'),
                    'izin': document.getElementById('dokumenIzin'),
                    'dinas-luar': document.getElementById('dokumenDinas'),
                };
                
                const presensiValue = presensiSelect.value;
                const fileInput = fileInputs[presensiValue];
                
                if (fileInput && fileInput.files[0]) {
                    const file = fileInput.files[0];
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => {
                        const fileData = {
                            base64: reader.result.split(',')[1],
                            type: file.type,
                            name: file.name
                        };
                        sendData(fileData);
                    };
                    reader.onerror = (error) => {
                        console.error('Error reading file:', error);
                        alert('Gagal membaca file.');
                        resetButton();
                    };
                } else {
                    sendData(null);
                }
            });

            function sendData(fileObject) {
                const data = {};
                data.namaPegawai = namaPegawaiSelect.value;
                data.presensi = presensiSelect.value;

                switch (data.presensi) {
                    case 'lupa-absensi':
                        data.tanggal = document.getElementById('tanggalLupaAbsen').value;
                        break;
                    case 'kendala-mesin':
                        data.deskripsiKendala = document.getElementById('deskripsiKendala').value;
                        data.tanggal = document.getElementById('tanggalKendala').value;
                        break;
                    case 'izin':
                        data.perihalIzin = document.getElementById('perihalIzin').value;
                        data.tanggal = document.getElementById('tanggalIzin').value;
                        break;
                    case 'wfa':
                        data.wfaPilihan = wfaPilihanSelect.value;
                        if (data.wfaPilihan === 'absensi-masuk') {
                            data.keterangan = document.getElementById('rencanaKerja').value;
                            data.tanggal = document.getElementById('tanggalWfaMasuk').value;
                        } else if (data.wfaPilihan === 'absensi-pulang') {
                            data.keterangan = document.getElementById('pencapaianKerja').value;
                            data.tanggal = document.getElementById('tanggalWfaPulang').value;
                        }
                        break;
                    case 'dinas-luar':
                        data.kotaTujuan = document.getElementById('kotaTujuan').value;
                        data.tanggalPergi = document.getElementById('tanggalPergi').value;
                        data.tanggalPulang = document.getElementById('tanggalPulang').value;
                        break;
                }

                if (fileObject) {
                    data.file = fileObject;
                }

                const scriptURL = 'https://script.google.com/macros/s/AKfycbzoRlWYNTgtiCcOPrecwZtAYGla9RFlYkgcULHamjQ3jbesffuls9nKPE8CWQHB5qM/exec';

                fetch(scriptURL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    body: JSON.stringify(data)
                })
                .then(response => {
                    console.log('Success!', response);
                    const selectedPegawai = namaPegawaiSelect.options[namaPegawaiSelect.selectedIndex].text;
                    modalMessage.textContent = `Laporan absensi atas nama ${selectedPegawai} sudah diterima.`;
                    successModal.classList.remove('hidden');
                    form.reset();
                    hideAllSections();
                    hideWfaSubSections();
                    resetButton();
                })
                .catch(error => {
                    console.error('Error!', error.message);
                    alert('Terjadi kesalahan saat mengirim laporan. Silakan coba lagi.');
                    resetButton();
                });
            }

            function resetButton() {
                submitButton.disabled = false;
                buttonText.textContent = 'Submit Laporan';
                loadingSpinner.classList.add('hidden');
            }

            function hideModal() {
                successModal.classList.add('hidden');
            }
            closeModalButton.addEventListener('click', hideModal);
            successModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    hideModal();
                }
            });
        });
    </script>
</body>
</html>
